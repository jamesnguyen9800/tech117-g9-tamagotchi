<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tamagotchi</title>

  <!-- Prism.js syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>

  <!-- Includes the stylesheet file styles.css -->
  <link rel="stylesheet" href="styles.css?v=2" />
</head>
<script>
  window.addEventListener("beforeprint", () => {
    const proto = document.getElementById("prototypeImage");
    const printHeroImg = document.querySelector("#print-hero img");

    if (proto && printHeroImg) {
      printHeroImg.src = proto.src;
    }
  });
</script>


<body>
  <!-- Fixed Navigation Menu -->
  <nav id="menu">
    <h3>Menu</h3>
    <ul>
      <li><a href="#top">Title</a></li>
      <li><a href="#information">Project Information</a></li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#circuit-diagram">Circuit</a></li>
      <li><a href="#environment">Environment</a></li>
      <li><a href="#bom">BoM</a></li>
      <li><a href="#prototype">Prototype</a></li>
      <li><a href="#code">Code</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      <li><a href="#references">References</a></li>
    </ul>
  </nav>
 <button class="print-button" onclick="window.print()" style="position: fixed; bottom: 24px; right: 24px; padding: 10px 16px; background: #2563eb; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.15); font-size: 0.9rem; z-index: 2000;">  Print This Page </button>

  <h1 id="top">Tamagotchi </h1>
<div id="print-hero">
    <img src="" alt="">
</div>

  <section id="information">
    <h2>Project Information</h2>
    <p><strong>Course:</strong> TECH 117 (Computer Engineering Technology, Fall 2025)</p>
    <p><strong>Instructor:</strong> Ph.D. Ana Rodrigues</p>
    <p><strong>Team Members:</strong></p>
    <ul>
      <li>Tam Nguyen</li>
      <li>Amrit Bhoon </li>
      <li>Kevin Pham </li>
      <li>Ryan Naraine </li>
    </ul>
  </section>

  <section id="introduction">
    <h2>Introduction</h2>
    <p>This project uses an <strong>Arduino Uno</strong>, <strong> 3 Tactile switchs top actuated</strong>, a
      <strong>SSD1306 I2C OLED 128x64</strong>, <strong>3 Resistors 1k ohms</strong> and a <strong>Buzzer </strong> to provide a display for the game and display reactions based on what buttons are pressed with audio.
    </p>
  </section>

  <section id="circuit-diagram">
    <h2>Circuit Diagram</h2>
    <p>The buttons are programmed to interact with the pet based on what combination of buttons are pressed, the OLED displays the game, and the buzzer will make sounds based on what happens in the game.</p>
    <img src="circuit diagram.jpg" alt="Arduino collision warning system">
  </section>

  <section id="environment">
    <h2>Environmental Impact Assessment</h2>
    <ul>
      <li><strong>Materials:</strong> The Arduino Uno is RoHS and WEEE compliant, limiting hazardous substances.
      </li>
      <li><strong>Energy Efficiency:</strong> The OLED displays are environmentally friendly due to their energy efficiency, reduced use of hazardous materials, less plastic in manufacturing, and fewer components</li>
      <li><strong>Reusability:</strong> All components can be reused onto different circuits, each component also reduces electronic waste because they last so long</li>
      <li><strong>Packaging & Shipping:</strong> Most components that were used are from the 
        Arduino kit itself, reducing the 
        carbon footprint.</li>
    </ul>
  </section>

  <section id="bom">
    <h2>Bill of Materials (BoM)</h2>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Unit Price</th>
          <th>Subtotal</th>
          <th>Source</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Arduino Uno Rev3</td>
          <td>1</td>
          <td>$27.60</td>
          <td>$27.60</td>
          <td><a href="https://store-usa.arduino.cc/products/arduino-uno-rev3">Arduino Store</a></td>
        </tr>
        <tr>
          <td> 0.96" L2C Oled Display</td>
          <td>1</td>
          <td>$18.93 </td>
          <td>$18.93 </td>
          <td><a href="https://www.amazon.ca/0-96inch-Module-Display-SSD1306-Driver/dp/B0CPZD1GS2/ref=sr_1_2_sspa?crid=34Q6D9NLD1YB4&dib=eyJ2IjoiMSJ9.ej80y8E0V6dcYJ8_2NtmzYpJfoCinra67I_oTUkcpAALlXMR9UKra3fOSdgDjp0UCn-onfywVHGEXkdPp469rd_9PdowhOhWS8agtCrXn2ggfXuYXQ0X5qpYs5GLx0Gn7d5cUxaf-QPFg0jIwBuJ26dgKgMEzDbUFhjoECRNlPCZr95sT-u87JLPidv5ZCpQvZxejbU__jJYLKFJe2HQE6FLlojXkqjNeCQfYer8YbqicbF_qaqTu8LFt5fqaUNlrX4ptPS22zq5-TuVy3qlnHncHAjgIGmm62ng6eKTwVs.6TzFy2gzPQe6ZnNIjTDQGJDTUhpRLhm33inMtd6Rsmo&dib_tag=se&keywords=ssd1306&qid=1761755503&sprefix=ssd1306+%2Caps%2C116&sr=8-2-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&psc=1">Amazon</a></td>
        </tr>
        <tr>
          <td>Passive Buzzer</td>
          <td>1</td>
          <td>$0.97</td>
          <td>$0.97</td>
          <td><a href="https://www.digikey.ca/en/products/detail/pui-audio-inc/AT-1224-TWT-5V-2-R/5011404">Digikey</a></td>
        </tr>
        <tr>
          <td>Tactile switches</td>
          <td>3</td>
          <td>$0.48</td>
          <td>$0.48</td>
           <td><a href="https://www.digikey.ca/en/products/detail/same-sky-formerly-cui-devices-/TS02-66-55-BK-160-LCR-D/15634374?gclsrc=aw.ds&gad_source=1&gad_campaignid=17336435733&gclid=EAIaIQobChMI2IWl0NL-kAMVoNHCBB3nOjljEAQYASABEgLmqPD_BwE">Digikey</a></td>
        </tr>
        <tr>
          <td>1k Ω Resistors</td>
          <td>10</td>
          <td>$0.41</td>
          <td>$0.41</td>
          <td><a href="https://www.digikey.ca/en/products/detail/stackpole-electronics-inc/CF14JT1K00/1741314">Digikey</a></td>
        </tr>
        <tr>
          <td>Breadboard</td>
          <td>1</td>
          <td>$4.95</td>
          <td>$4.95</td>
          <td><a href="https://www.adafruit.com/product/64">Adafruit</a></td>
        </tr>
        <tr>
          <td>Jumper Wires</td>
          <td>1 set</td>
          <td>$3.50</td>
          <td>$3.50</td>
          <td><a href="https://www.sparkfun.com/jumper-wires-standard-7-m-m-30-awg-30-pack.html">SparkFun</a>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3">Estimated Total</td>
          <td>$56.84</td>
          <td>—</td>
        </tr>
      </tfoot>
    </table>
  </section>

  <section id="prototype">
    <h2>Prototype</h2>
    <p>The following image shows the assembled prototype on a breadboard.</p>
    <img  id="prototypeImage" src="prototype.jpg" alt="Collision warning system prototype">
  </section>

  <section id="code">
    <h2>Arduino Code</h2>
    <p>The following Arduino code controls the system, lighting LEDs and activating the buzzer based on distance readings from the HC-SR04 sensor.</p>
<div class="code-container" style="position: relative;">
      <button class="copy-btn" onclick="copyCode()" 
              style="position:absolute; top:8px; right:8px; z-index:10;">
          Copy
      </button>

      <pre class="line-numbers">
 
  <code id="arduinoCode" class="language-cpp">
#include <U8g2lib.h>
#include <Wire.h>
#include <EEPROM.h>
#include "tamalib.h"
#include "hw.h"
#include "bitmaps.h"
#include "hardcoded_state.h"

/***** U8g2 SSD1306 Library Setting *****/
#define DISPLAY_I2C_ADDRESS 0x3C
#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels
/****************************************/

/***** Tama Setting and Features *****/
#define TAMA_DISPLAY_FRAMERATE  3   // 3 is optimal for Arduino UNO
#define ENABLE_TAMA_SOUND
#define ENABLE_AUTO_SAVE_STATUS
#define AUTO_SAVE_MINUTES 60    // Auto save for every hour (to preserve EEPROM lifespan)
#define ENABLE_LOAD_STATE_FROM_EEPROM 
//#define ENABLE_DUMP_STATE_TO_SERIAL_WHEN_START
//#define ENABLE_SERIAL_DEBUG_INPUT
//#define ENABLE_LOAD_HARCODED_STATE_WHEN_START
/***************************/

/***** Set display orientation, U8G2_MIRROR_VERTICAL is not supported *****/
#define U8G2_LAYOUT_NORMAL
//#define U8G2_LAYOUT_ROTATE_180
//#define U8G2_LAYOUT_MIRROR
/**************************************************************************/

#ifdef U8G2_LAYOUT_NORMAL
U8G2_SSD1306_128X64_NONAME_2_HW_I2C display(U8G2_R0);
#endif

#ifdef U8G2_LAYOUT_ROTATE_180
U8G2_SSD1306_128X64_NONAME_2_HW_I2C display(U8G2_R2);
#endif

#ifdef U8G2_LAYOUT_MIRROR
U8G2_SSD1306_128X64_NONAME_2_HW_I2C display(U8G2_MIRROR);
#endif

/**** TamaLib Specific Variables ****/
static uint16_t current_freq = 0; 
static bool_t matrix_buffer[LCD_HEIGHT][LCD_WIDTH/8] = {{0}};
static byte runOnceBool = 0;
static bool_t icon_buffer[ICON_NUM] = {0};
static cpu_state_t cpuState;
static unsigned long lastSaveTimestamp = 0;
/************************************/

static void hal_halt(void) {
  //Serial.println("Halt!");
}

static void hal_log(log_level_t level, char *buff, ...) {
  Serial.println(buff); 
}

static void hal_sleep_until(timestamp_t ts) {
  //int32_t remaining = (int32_t) (ts - hal_get_timestamp());
  //if (remaining > 0) {
    //delayMicroseconds(1);
    //delay(1);
  //}
}

static timestamp_t hal_get_timestamp(void) {
  return millis() * 1000;
}

static void hal_update_screen(void) {
  displayTama();
} 

static void hal_set_lcd_matrix(u8_t x, u8_t y, bool_t val) {
  uint8_t mask;
  if (val) {
    mask = 0b10000000 >> (x % 8);
    matrix_buffer[y][x/8] = matrix_buffer[y][x/8] | mask;   
  } else { 
    mask = 0b01111111;
    for(byte i=0;i<(x % 8);i++) {
      mask = (mask >> 1) | 0b10000000;
    }
    matrix_buffer[y][x/8] = matrix_buffer[y][x/8] & mask;  
  }
}

static void hal_set_lcd_icon(u8_t icon, bool_t val) {
  icon_buffer[icon] = val;
}

static void hal_set_frequency(u32_t freq) {
  current_freq = freq;
}

static void hal_play_frequency(bool_t en) {
#ifdef ENABLE_TAMA_SOUND 
  if (en) {
    tone(9, current_freq); 
  } else {
    noTone(9); 
  }
#endif  
}

static bool_t button4state = 0;

static int hal_handler(void) {
#ifdef ENABLE_SERIAL_DEBUG_INPUT 
  if (Serial.available() > 0) {
    int incomingByte = Serial.read();
    Serial.println(incomingByte, DEC);
    if (incomingByte==49) {
      hw_set_button(BTN_LEFT, BTN_STATE_PRESSED );
    } else if (incomingByte==50) {
      hw_set_button(BTN_LEFT, BTN_STATE_RELEASED );
    } else if (incomingByte==51) {
      hw_set_button(BTN_MIDDLE, BTN_STATE_PRESSED );
    } else if (incomingByte==52) {
      hw_set_button(BTN_MIDDLE, BTN_STATE_RELEASED );
    } else if (incomingByte==53) {
      hw_set_button(BTN_RIGHT, BTN_STATE_PRESSED );
    } else if (incomingByte==54) {
      hw_set_button(BTN_RIGHT, BTN_STATE_RELEASED );
    }  
  } 
#else  
  if (digitalRead(2) == HIGH) {
    hw_set_button(BTN_LEFT, BTN_STATE_PRESSED );
  } else {
    hw_set_button(BTN_LEFT, BTN_STATE_RELEASED );
  }
  if (digitalRead(3) == HIGH) {
    hw_set_button(BTN_MIDDLE, BTN_STATE_PRESSED );
  } else {
    hw_set_button(BTN_MIDDLE, BTN_STATE_RELEASED );
  }
  if (digitalRead(4) == HIGH) {
    hw_set_button(BTN_RIGHT, BTN_STATE_PRESSED );
  } else {
    hw_set_button(BTN_RIGHT, BTN_STATE_RELEASED );
  }
  #ifdef ENABLE_AUTO_SAVE_STATUS 
    if (digitalRead(5) == HIGH) {
      if (button4state==0) {
        saveStateToEEPROM();
      }
      button4state = 1;
    } else {
      button4state = 0;
    }
  #endif
#endif  
  return 0;
}

static hal_t hal = {
  .halt = &hal_halt,
  .log = &hal_log,
  .sleep_until = &hal_sleep_until,
  .get_timestamp = &hal_get_timestamp,
  .update_screen = &hal_update_screen,
  .set_lcd_matrix = &hal_set_lcd_matrix,
  .set_lcd_icon = &hal_set_lcd_icon,
  .set_frequency = &hal_set_frequency,
  .play_frequency = &hal_play_frequency,
  .handler = &hal_handler,
};

void drawTriangle(uint8_t x, uint8_t y) {
  //display.drawLine(x,y,x+6,y);
  display.drawLine(x+1,y+1,x+5,y+1);
  display.drawLine(x+2,y+2,x+4,y+2); 
  display.drawLine(x+3,y+3,x+3,y+3); 
}

void drawTamaRow(uint8_t tamaLCD_y, uint8_t ActualLCD_y, uint8_t thick) {
  uint8_t i;
  for (i = 0; i < LCD_WIDTH; i++) {
    uint8_t mask = 0b10000000;
    mask = mask >> (i % 8);
    if ( (matrix_buffer[tamaLCD_y][i/8] & mask) != 0) {
        display.drawBox(i+i+i+16,ActualLCD_y,2,thick);
    }
  }
}

void drawTamaSelection(uint8_t y) {
  uint8_t i;
  for(i=0;i<7;i++) {
    if (icon_buffer[i]) drawTriangle(i*16+5,y);
    display.drawXBMP(i*16+4,y+6,16,9,bitmaps+i*18);
  }
  if (icon_buffer[7]) {
    drawTriangle(7*16+5,y);
    display.drawXBMP(7*16+4,y+6,16,9,bitmaps+7*18);
  } 
}

void displayTama() {
  uint8_t j;
  display.firstPage();
#ifdef U8G2_LAYOUT_ROTATE_180
    drawTamaSelection(49);
    display.nextPage();

    for (j = 11; j < LCD_HEIGHT; j++) {
      drawTamaRow(j,j+j+j,2);
    }
    display.nextPage();

    for (j = 5; j <= 10; j++) {
      if (j==5) {
        drawTamaRow(j,j+j+j+1,1);
      } else {
        drawTamaRow(j,j+j+j,2);
      }
    }
    display.nextPage();

    for (j = 0; j <= 5; j++) {
      if (j==5) {
        drawTamaRow(j,j+j+j,1);
      } else {
        drawTamaRow(j,j+j+j,2);
      }    
    }
    display.nextPage();
#else
    for (j = 0; j < LCD_HEIGHT; j++) {
      if (j!=5) drawTamaRow(j,j+j+j,2);
      if (j==5) {
         drawTamaRow(j,j+j+j,1);
         display.nextPage();
         drawTamaRow(j,j+j+j+1,1);
      }
      if (j==10) display.nextPage();
    }
    display.nextPage();
    drawTamaSelection(49);
    display.nextPage();
#endif  
}

#ifdef ENABLE_DUMP_STATE_TO_SERIAL_WHEN_START
void dumpStateToSerial() {
  uint16_t i, count=0;
  char tmp[10];
  cpu_get_state(&cpuState);
  u4_t *memTemp = cpuState.memory;
  uint8_t *cpuS = (uint8_t *)&cpuState;

  Serial.println("");
  Serial.println("static const uint8_t hardcodedState[] PROGMEM = {");
  for(i=0;i<sizeof(cpu_state_t);i++,count++) {
    sprintf(tmp, "0x%02X,", cpuS[i]);
    Serial.print(tmp);
    if ((count % 16)==15) Serial.println("");
  }
  for (i = 0; i < MEMORY_SIZE; i++,count++) {
    sprintf(tmp, "0x%02X,",memTemp[i]);
    Serial.print(tmp);
    if ((count % 16)==15) Serial.println("");
  }  
  Serial.println("};");
/*
  Serial.println("");
  Serial.println("static const uint8_t bitmaps[] PROGMEM = {");
  for(i=0;i<144;i++) {
    sprintf(tmp, "0x%02X,", bitmaps_raw[i]);
    Serial.print(tmp);
    if ((i % 18)==17) Serial.println("");
  }
  Serial.println("};");  */
} 
#endif

#ifdef ENABLE_LOAD_HARCODED_STATE_WHEN_START
void loadHardcodedState() {
  cpu_get_state(&cpuState);
  u4_t *memTemp = cpuState.memory;
  uint16_t i;
  uint8_t *cpuS = (uint8_t *)&cpuState;
  for(i=0;i<sizeof(cpu_state_t);i++) {
    cpuS[i]=pgm_read_byte_near(hardcodedState+i);
  }
  for(i=0;i<MEMORY_SIZE;i++) {
    memTemp[i]=pgm_read_byte_near(hardcodedState+ sizeof(cpu_state_t) + i);
  }
  cpuState.memory = memTemp;
  cpu_set_state(&cpuState);
  Serial.println("Hardcoded");
 }
#endif

#ifdef ENABLE_AUTO_SAVE_STATUS 
void saveStateToEEPROM() {
  int i=0;
  if (EEPROM.read(0)!=12) {
    // Clear EEPROM
    for (i = 0 ; i < EEPROM.length() ; i++) {
      EEPROM.write(i, 0);
    }
  }
  EEPROM.update(0, 12);
  cpu_get_state(&cpuState);
  EEPROM.put(1, cpuState); 
  for(i=0;i<MEMORY_SIZE;i++) {
    EEPROM.update(1 + sizeof(cpu_state_t) + i, cpuState.memory[i]);
  }
  Serial.println("S");
}
#endif

#ifdef ENABLE_LOAD_STATE_FROM_EEPROM
void loadStateFromEEPROM() {
  cpu_get_state(&cpuState);
  u4_t *memTemp = cpuState.memory;
  EEPROM.get(1, cpuState);
  cpu_set_state(&cpuState);
  int i=0;
  for(i=0;i<MEMORY_SIZE;i++) {
    memTemp[i] = EEPROM.read(1 + sizeof(cpu_state_t) + i);
  }
  Serial.println("L");
}
#endif


uint8_t reverseBits(uint8_t num) {
    uint8_t reverse_num = 0;
    uint8_t i;
    for (i = 0; i < 8; i++) {
        if((num & (1 << i)))
           reverse_num |= 1 << ((8 - 1) - i);  
   }
   return reverse_num;
}

void setup() {
  Serial.begin(9600);
  pinMode(2, INPUT);
  pinMode(3, INPUT);
  pinMode(4, INPUT);
  pinMode(5, INPUT);
  pinMode(9, OUTPUT);

  display.setI2CAddress(DISPLAY_I2C_ADDRESS * 2);  // required if display does not use default address of 0x3C
  display.begin();  // initialize U8g2 graphics library for selected display module

  tamalib_register_hal(&hal);
  tamalib_set_framerate(TAMA_DISPLAY_FRAMERATE);
  tamalib_init(1000000);

#ifdef ENABLE_LOAD_STATE_FROM_EEPROM 
  if (EEPROM.read(0)==12) {
    loadStateFromEEPROM();
  }
#endif  

#ifdef ENABLE_LOAD_HARCODED_STATE_WHEN_START
  loadHardcodedState();
#endif

/*
  int i;
  for(i=0;i<(18*8);i++) {
    bitmaps_raw[i]= reverseBits(bitmaps_raw[i]);
  }
*/

#ifdef ENABLE_DUMP_STATE_TO_SERIAL_WHEN_START
  dumpStateToSerial();
#endif 

}

void loop() {
  tamalib_mainloop_step_by_step();
#ifdef ENABLE_AUTO_SAVE_STATUS   
  if ((millis() - lastSaveTimestamp) > (AUTO_SAVE_MINUTES * 60 * 1000)) {
    lastSaveTimestamp = millis();
    saveStateToEEPROM();
  }
#endif  
}
    </code>
  </pre>

    <script>
      function copyCode() {
        const code = document.getElementById('arduinoCode').innerText;
        navigator.clipboard.writeText(code).then(() => {
          alert('Code copied to clipboard!');
        });
      }
    </script>
  </section>



  <section id="conclusion">
    <h2>Conclusion</h2>
    <p>The system effectively displays the game and effectivly helps with peoples mental health through entertainment it is energy efficient and all parts are reusable.</p>
  </section>

 <section id="references">
  <h2>References</h2>

  <ul>
    <li>
      Arduino Project Hub. (n.d.). 
      <em>A real Tamagotchi emulator for Arduino UNO.</em> 
      Arduino Project Hub. 
      <a href="https://projecthub.arduino.cc/garyz-hk/a-real-tamagotchi-emulator-for-arduino-uno-d84435" target="_blank" rel="noopener noreferrer">
        https://projecthub.arduino.cc/garyz-hk/a-real-tamagotchi-emulator-for-arduino-uno-d84435
      </a>
    </li>

    <li>
      Instructables (n.d.). 
      <em>Arduino Tamagotchi Clone - Digital Pet.</em> Instructables
      <a href="https://www.instructables.com/Arduino-Tamagotchi-Clone-Digital-Pet/" target="_blank" rel="noopener noreferrer">
        https://www.instructables.com/Arduino-Tamagotchi-Clone-Digital-Pet/
      </a>
    </li>

    <li>
      Github (n.d.). 
      <em>ArduinoGotchi</em> 
      Github. 
      <a href="https://projecthub.arduino.cc/projects/tags/led" target="_blank" rel="noopener noreferrer">
        https://projecthub.arduino.cc/projects/tags/led
      </a>
    </li>


</body>

</html>
